<link href="https://vjs.zencdn.net/7.15.4/video-js.css" rel="stylesheet" />

<style type="text/css">
body { background-color: #111; margin: 0; padding: 0; }
#castbutton { display: block; height: 30px; position: fixed; right: 0; top: 0; padding: 5px; z-index: 1000; }
.video-js { width: 100%; height: 100%; }
video { width: 100%; }
</style>

<google-cast-launcher id="castbutton"></google-cast-launcher>
<video id="stream-video" width="100%" class="video-js vjs-default-skin" controls muted>
</video>

<script src="video.min.js"></script>
<script src="videojs-contrib-hls.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
<script>

let applicationId = "A50C8A3C";
let remotePlayer;
let remotePlayerController;
let instance;

window.onload = function() {
    var castPlayer = new CastPlayer();
}

window['__onGCastApiAvailable'] = function (isAvailable) {
  if (isAvailable) {

      // get and configure our instance
      instance = cast.framework.CastContext.getInstance()
      instance.setOptions({
        receiverApplicationId: applicationId,
        autoJoinPolicy: chrome.cast.AutoJoinPolicy.PAGE_SCOPED
      });
  }
}



var retrypid;

var player = videojs('stream-video');
function playStream() {
//  jQuery.get("https://bodygen.re:8080/api/status").done(function(e,i)  {
//    if (e.online) {
      player.src({
        src: "https://cdn.c3voc.de/hls/revision/native_hd.m3u8",
        type: "application/x-mpegURL"
      });
      player.play();

      clearInterval(retrypid);
//    }
//  });
}

retrypid = setInterval(function() {
  playStream();
}, 2000);

playStream();

player.on('ended', function() {
  retrypid = setInterval(function() {
    playStream();
  }, 2000);
})



setTimeout(function() {
  // iframe:
  function updateParentWindowDims(cause) {
      window.parent.postMessage({ message: 'resize', height: player.videoHeight(), width: player.videoWidth(), cause:cause }, "*");
  }
//  if (window.parent !== window) {
      updateParentWindowDims('init');
      setTimeout(function() { updateParentWindowDims('100ms after') }, 100);
      setTimeout(function() { updateParentWindowDims('500ms after') }, 500);
      setTimeout(function() { updateParentWindowDims('1s after') }, 1000);
      document.getElementsByTagName('video')[0].addEventListener('progress', function() { updateParentWindowDims('progress'); })
      window.onresize = function() { updateParentWindowDims('resized') };
//  }
}, 100)
</script>
